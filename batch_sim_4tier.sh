#!/bin/bash
numConns=$1
totalJobs=$2
netLat=30
time=$(date)
echo $time

# tmp_dir='/filer-01/qsim/logs/'$time'_'$app$num
tmp_dir='/home/zhangyanqi/qsim/logs/4tier/nConn_'$numConns'_total_job_'$totalJobs
mkdir -p $tmp_dir


# qps=(50 100 150 200 250 300 350 400 450 500 550 600 650 700 750 800 850 900 950 1000) # 20
# lat=(20000.0 10000.0 6666.666666666667 5000.0 4000.0 3333.3333333333335 2857.1428571428573 2500.0 2222.222222222222 2000.0 1818.1818181818182 1666.6666666666667 1538.4615384615386 1428.5714285714287 1333.3333333333333 1250.0 1176.4705882352941 1111.111111111111 1052.6315789473683 1000.0)
qps=(100 200 300 400 500 600 700 800 900 1000 1100 1200 1300 1400 1500 1600 1700 1800 1900 2000 2100 2200 2300 2400 2500 2600 2700 2800 2900 3000 3100 3200 3300 3400 3500 3600 3700 3800 3900 4000 4100 4200 4300 4400 4500 4600 4700 4800 4900 5000) #50
lat=(10000.0 5000.0 3333.3333333333335 2500.0 2000.0 1666.6666666666667 1428.5714285714287 1250.0 1111.111111111111 1000.0 909.0909090909091 833.3333333333334 769.2307692307693 714.2857142857143 666.6666666666666 625.0 588.2352941176471 555.5555555555555 526.3157894736842 500.0 476.1904761904762 454.54545454545456 434.7826086956522 416.6666666666667 400.0 384.61538461538464 370.3703703703704 357.14285714285717 344.82758620689657 333.3333333333333 322.5806451612903 312.5 303.030303030303 294.11764705882354 285.7142857142857 277.77777777777777 270.27027027027026 263.1578947368421 256.4102564102564 250.0 243.90243902439025 238.0952380952381 232.5581395348837 227.27272727272728 222.22222222222223 217.3913043478261 212.7659574468085 208.33333333333334 204.08163265306123 200.0)

for i in {0..49}
# for i in {0..0}
do 
	filename=$tmp_dir'/''qps_'${qps[$i]}.out
	touch $filename
	./microsim ./architecture/4tier/ $totalJobs $numConns $netLat expo ${lat[$i]} > $filename 
	# ./test_memcached $numConns ${kqps[$i]} $totalJobs $numThreads $numCores debug-off
	echo done ${qps[$i]}
done
echo done $filename all